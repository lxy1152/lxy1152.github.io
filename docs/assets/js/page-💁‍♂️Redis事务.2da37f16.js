(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{791:function(e,s,n){"use strict";n.r(s);var a=n(1),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"redis-怎么处理事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-怎么处理事务"}},[e._v("#")]),e._v(" Redis 怎么处理事务？")]),e._v(" "),n("p",[e._v("Redis 使用 "),n("code",[e._v("MULTI")]),e._v("、"),n("code",[e._v("EXEC")]),e._v("、"),n("code",[e._v("DISCARD")]),e._v("、"),n("code",[e._v("WATCH")]),e._v(" 这四个命令完成事务。")]),e._v(" "),n("p",[e._v("使用 "),n("code",[e._v("MULTI")]),e._v(" 开启事务，客户端可以向服务器发送任意多个命令，这些命令不会立马执行，而是被放到一个队列中，当调用 "),n("code",[e._v("EXEC")]),e._v(" 命令时，所有队列中的命令才会被执行。如果没有执行 "),n("code",[e._v("EXEC")]),e._v("，那么事务中的所有命令都不会被执行。如果在执行 "),n("code",[e._v("EXEC")]),e._v(" 命令之后发生了错误，或者在事务中某个命令发生了错误，事务也会正常执行，不会进行回滚。比如下面的操作将正常执行：")]),e._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('127.0.0.1:6379> multi \nOK \n127.0.0.1:6379> set key value1 \nQUEUED \n127.0.0.1:6379> incr key \nQUEUED \n127.0.0.1:6379> set key value2 \nQUEUED \n127.0.0.1:6379> exec \n1) OK \n2) (error) ERR value is not an integer or out of range \n3) OK \n127.0.0.1:6379> get key \n"value2" \n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br")])]),n("p",[e._v("通过调用 "),n("code",[e._v("DISCARD")]),e._v(" 命令，客户端可以清空事务队列，并放弃执行事务。在事务执行之前，可以通过 "),n("code",[e._v("WATCH")]),e._v(" 命令监视一个或多个 "),n("code",[e._v("key")]),e._v("，如果在事务执行之前这个（或这些）"),n("code",[e._v("key")]),e._v(" 被其他命令修改了，那么事务将被打断。可以视为 Redis 提供的 CAS 锁。")])])}),[],!1,null,null,null);s.default=t.exports}}]);