(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{763:function(e,v,_){"use strict";_.r(v);var t=_(1),a=Object(t.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h2",{attrs:{id:"如何高效处理大库-ddl"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#如何高效处理大库-ddl"}},[e._v("#")]),e._v(" 如何高效处理大库 DDL？")]),e._v(" "),_("p",[e._v("有时希望在不停机的情况下在某张表中添加或删除某个字段，大多数的 "),_("code",[e._v("alter table")]),e._v(" 操作都会涉及 "),_("code",[e._v("lock --\x3e copy to new table --\x3e rename --\x3e unlock")]),e._v(" 的过程，数据量太大的情况下，锁表的时间会很长，而且 "),_("code",[e._v("alter table")]),e._v(" 的进程不可以被杀死，一旦执行就不可回退。")]),e._v(" "),_("p",[e._v("从 MySQL 5.6 开始，Online DDL 特性被引进，它增强了很多种类的 "),_("code",[e._v("alter table")]),e._v(" 操作避免拷贝表和锁表，在运行 "),_("code",[e._v("alter")]),e._v(" 操作的同时允许运行 "),_("code",[e._v("select")]),e._v("、"),_("code",[e._v("insert")]),e._v("、"),_("code",[e._v("update")]),e._v("、"),_("code",[e._v("delete")]),e._v(" 语句。但是仍然有一些 "),_("code",[e._v("alter")]),e._v(" 操作（比如：增加/删除列，增加/删除主键，改变数据类型等）需要重建表。并不建议直接在线上使用 "),_("code",[e._v("alter table")]),e._v("。建议使用以下两种方式：")]),e._v(" "),_("h3",{attrs:{id:"主从架构轮询修改"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#主从架构轮询修改"}},[e._v("#")]),e._v(" 主从架构轮询修改")]),e._v(" "),_("p",[e._v("这种方式使用的前提是使用了集群，修改的原理就是利用主从服务，在应用无感知的情况下，得到停机窗口，进行修改。")]),e._v(" "),_("h3",{attrs:{id:"利用已有的工具"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#利用已有的工具"}},[e._v("#")]),e._v(" 利用已有的工具")]),e._v(" "),_("p",[e._v("可以使用 online-schema-change 工具来进行 DDL。它会创建一个和要执行 "),_("code",[e._v("alter")]),e._v(" 操作的表一样的空表，执行表结构修改，然后从原表中复制原始数据到新表中。当数据复制完成以后就会用新表代替原表，默认动作是将原表 "),_("code",[e._v("drop")]),e._v("。在复制数据的过程中，任何在原表的更新操作都会同步更新到新表，因为这个工具会在原表上创建了触发器。")]),e._v(" "),_("h2",{attrs:{id:"mysql-有哪些约束"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql-有哪些约束"}},[e._v("#")]),e._v(" MySQL 有哪些约束？")]),e._v(" "),_("ul",[_("li",[e._v("非空约束："),_("code",[e._v("not null")])]),e._v(" "),_("li",[e._v("唯一性约束："),_("code",[e._v("unique")]),e._v("，表示具备唯一性，可为 "),_("code",[e._v("null")])]),e._v(" "),_("li",[e._v("主键约束："),_("code",[e._v("primary key")])]),e._v(" "),_("li",[e._v("外键约束："),_("code",[e._v("foreign key")])]),e._v(" "),_("li",[e._v("检查约束："),_("code",[e._v("check")]),e._v("，MySQL 不支持")]),e._v(" "),_("li",[e._v("默认约束："),_("code",[e._v("default")]),e._v("，保证字段会有一个默认值")])]),e._v(" "),_("h2",{attrs:{id:"数据库外键的优缺点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据库外键的优缺点"}},[e._v("#")]),e._v(" 数据库外键的优缺点？")]),e._v(" "),_("ul",[_("li",[e._v("优点\n"),_("ul",[_("li",[e._v("能最大限度的保证数据的一致性和完整性")]),e._v(" "),_("li",[e._v("增加 ER 图的可读性")])])]),e._v(" "),_("li",[e._v("缺点\n"),_("ul",[_("li",[e._v("影响数据操作的效率")]),e._v(" "),_("li",[e._v("增加开发难度，导致表过多")])])])])])}),[],!1,null,null,null);v.default=a.exports}}]);