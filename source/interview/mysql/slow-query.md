---
title: 👎 慢查询
---

## Mysql 什么情况会造成慢查询，如何查看慢查询日志？

响应时间超过阈值会产生慢查询日志，一般以下情况会造成查询慢：

- 没有设置索引，或查询没有用到索引
- I/O 吞吐量过小
- 内存不足
- 网络速度慢
- 查询的数据量过大
- 锁或者死锁
- 返回了不必要的行或列
- 查询语句存在问题，需要优化

慢查询日志默认是关闭的，如果非必要，不要开启，会影响性能。使用 `SHOW VARIABLES LIKE 'slow_query%'` 查询得到：

- slow_query_log：是否开启慢查询日志
- slow_query_log_file：慢查询日志存储位置

## 如何解决慢查询？

- 把数据、日志、索引放到不同的 I/O 设备上，增加读取速度
- 纵向、横向分割表，减少表的尺寸
- 升级硬件
- 根据查询条件，建立索引，索引优化
- 提高网速
- 扩大服务器内存
- 分库分表

## 数据库优化的方式有哪些？

- 排除缓存的干扰
- 通过 explain 获取执行计划
- 使用覆盖索引
- 使用联合索引
- 最左匹配原则
  在模糊查询中如果使用 xx% 的形式还是能够利用索引的。
- 使用前缀索引
- 不要在条件中使用函数
- 不要使用隐式类型转换

:::tip MySQL 的缓存
MySQL 8 之前版本的数据库是存在缓存的，如果当前的 MySQL 支持缓存同时也开启了缓存，那每次请求的查询语句和结果都会以 key-value 的形式进行缓存，在查询时会优先查找缓存，但只要数据一更新，缓存就会失效，所以缓存的用处并不大。在 `select` 语句上添加 `sql_no_cache` 可以避免使用缓存。
:::
