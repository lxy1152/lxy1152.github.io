---
title: 🤞 锁
---

## 什么是共享锁和排他锁？

### 共享锁

使用方式为：`select * from table lock in share mode`，表示自身可以读，其他事务也可以读（也可以继续加共享锁），但是其他事务无法修改。

### 排它锁
  
使用方式为：`select * from table for update`，表示自身可以进行增删改查，其他事务无法进行任何操作。排它锁是一种悲观锁，更新、插入、删除默认加排它锁，查询默认不加锁。

## 什么是 Next-Key Lock？<Badge text="重点" type="error"/>

InnoDB 有三种锁的方式：

- Record Lock：对某一行上锁
- Gap Lock：间隙锁，锁定一个范围，但不包括记录本身，目的在于防止同一事务的两次读出现幻读
- Next-Key Lock：上面两种锁的组合，它会锁定一个范围，并且锁定记录本身，主要目的是为了解决幻读

假设某一个时刻，某张表的 id 只有两个值，分别为 10 和 14。如果查询条件为 id > 9，并且某个事务新插入了一条 id = 12 的数据，使用前两种锁将导致幻读。
